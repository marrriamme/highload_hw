# Highload

[Задание](https://github.com/init/highload/blob/main/homework_architecture.md)

Репозиторий курсовой работы по дисциплине "Проектирование высоконагруженных систем"

[**1. Тема и целевая аудитория**](#1-тема-и-целевая-аудитория)
[**2. Расчет нагрузки**](#2-расчет-нагрузки)

[**Список использованных источников**](#список-использованных-источников)


## 1. Тема и целевая аудитория

Duolingo — бесплатная платформа для изучения языков, также имеющая курсы математики, музыки и шахматам[[1](https://ru.wikipedia.org/wiki/Duolingo)].

### Число активных пользователей

  * MAU на 1 квартал 2022 года: 49,2 млн[[2](https://investors.duolingo.com/static-files/d667f9d1-8f7f-418c-b116-e699a30a9826)]
  * DAU на 1 квартал 2022 года: 12,5 млн 
  * Средняя продолжительность посещения: 15 минут 39 секунд [[3](https://usesignhouse.com/blog/duolingo-stats/)]

### Целевая аудитория

* По странам[[4](https://usesignhouse.com/blog/duolingo-stats/)]:

  ![image](./images/cantry.jpg "Статистика использования по cтранам")
  Всего пользователей: 575 млн[[5](https://cooljugator.com/blog/duolingo-statistics/)]

### Требования к функционалу
  * Регистрация и авторизация
  * Выбор языка для изучения
  * Уроки (с делением на разделы и модули)
    - множественный выбор
    - сопоставление слов
    - аудирование
    - говорение
    - правописание
  * Система прогресса 
  * Ежедневная цель и трекер
  * Система напоминаний
  * Подписки, добавление в друзья, комментарии
  * Алфавит
  * Возможность изменения уроков их авторами

## 2. Расчет нагрузки

| Метрика | Значение |
| :--- | :--- | 
| **Месячная аудитория (MAU)** | **49,2 млн** |
| **Дневная аудитория (DAU)** | **12,5 млн** | 
| **Средняя продолжительность сессии** | **15,65 минут** | 

Согласно источнику[[6](https://hu.duolingo.com/privacy)], хранятся следующие индивидуальные пользовательские данные:
- **основной профиль и учетные данные**: возраст, email, номер телефона, имя, фамилия, биография, фото профиля;
- **учебный прогресс и активность**: изучаемые языки, статистика, достижения, история пройденных уроков и упражнений;
- **пользовательский контент**: комментарии на профиле;
- **аудиоданные и транскрипты**: аудиозаписи голоса с упражнений на произношение;
- **cоциальные данные**: cписки подписчиков и подписок.

### Размер хранения в разбивке по типам данных

| Тип данных | Средний размер | Единиц в день | Общее количество | Общий объем | Прирост в день | Прирост в месяц | На пользователя (шт) | На пользователя (ГБ) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **Аудиозаписи голоса** | 2,4 МБ/мин | 4 мин | 2,94×10¹¹ | 282 000 ТБ | +183 ТБ | +5 490 ТБ | 235,2 | 0,57 |
| **Данные профиля** | 50 КБ | - | 4,92×10⁷ | 2,46 ТБ | +0,625 ТБ | +18,75 ТБ | 1 | 0,00005 |
| **Учебный прогресс** | 100 КБ | - | 4,92×10⁷ | 4,92 ТБ | +1,25 ТБ | +37,5 ТБ | 1 | 0,0001 |
| **Социальные связи** | 20 КБ | - | 4,92×10⁷ | 0,98 ТБ | +0,25 ТБ | +7,5 ТБ | 1 | 0,00002 |
| **Итого** | | | **2,94×10¹¹** | **282 008 ТБ** | **+185,125 ТБ** | **+5 553,75 ТБ** | **238,2** | **~0,57 ГБ** |

**1. Аудиозаписи голоса (основной объем):**
- Высокое качество(320kbps): 2,40 МБ/мин [[7](https://digitark.telia.ee/ru/era/%D0%B2%D1%81%D0%B5-%D1%82%D0%BE%D1%87%D0%BA%D0%B8-%D0%BD%D0%B0%D0%B4-%D0%B8%D1%82-%D0%BA%D0%B0%D0%BA-%D0%B2%D1%8B%D0%B1%D1%80%D0%B0%D1%82%D1%8C-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BC-%D0%BC%D0%BE/#:~:text=%D0%9D%D0%B8%D0%B7%D0%BA%D0%BE%D0%B5%20%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE%20%D0%B0%D1%83%D0%B4%D0%B8%D0%BE%20(96kpps)%20%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D1%82,115%2C2%20%D0%9C%D0%B1%20%D0%B2%20%D1%87%D0%B0%D1%81.)]
- Единиц в день: 4 минуты аудио (эквивалент 3-х заданий по 1 минуте с запасом на ошибки пользователя и прослушивание отдельных слов)
- Прирост в день:[[8](https://www.statista.com/statistics/1309604/duolingo-quarterly-dau/)]
  ![image](./images/dau.jpg "Статистика роста DAU")
- Прирост в месяц:
  ![image](./images/mau.jpg "Статистика роста MAU")

**2. Данные профиля:**
- Средний размер: 50 КБ 
- Общее количество: 49,2M пользователей
- Общий объем: 49,2M × 50 КБ / 1 073 741 824 ≈ 2,46 ТБ
- Прирост: пропорционально новым регистрациям [[9](https://duolingoguides.com/how-many-people-use-duolingo/)]

**3. Учебный прогресс:**
- Средний размер: 100 КБ 
- Общий объем: 49,2M × 100 КБ / 1 073 741 824 ≈ 4,92 ТБ

**4. Социальные связи:**
- Средний размер: 20 КБ 
- Общий объем: 49,2M × 20 КБ / 1 073 741 824 ≈ 0,98 ТБ

**Ключевые допущения:**
1. Аудиоданные хранятся 3,5 года (средний срок активности пользователя)
2. Коэффициент активности: 70% пользователей регулярно генерируют контент
3. Основной объем хранилища составляют аудиозаписи

### RPS в разбивке по типам запросов

- Общее количество запросов в день (DAU * запросов на пользователя): 12.5M пользователей * 50 запросов = 625 000 000 запросов/день
- Средний RPS (за 16-часовой активный день): 625 000 000 запросов / (16 часов * 3600 секунд) ≈ 10 850 RPS
- Пиковый RPS (с коэффициентом x7): 10 850 RPS * 7 ≈ 76 000 RPS

Разделим трафик на два типа: легкий и тяжелый (аудио).

**Легкий трафик:**
- Средний размер запроса/ответа: 5 КБ (усредненный JSON)
- Общий объем: 625 000 000 запросов * 5 КБ = 2 925 000 000 КБ ≈ 2 790 ТБ/день
- Средняя полоса пропускания: 2 790 ТБ / (16 * 3600) ≈ 48.4 Гбит/с
- Пиковая полоса пропускания: 48.4 Гбит/с * 7 ≈ 339 Гбит/с

**Тяжелый трафик (Аудио):**
- Объем данных в день: +183 ТБ/день
- Скачивание аудио для проверки и прослушивания образцов может добавлять еще ~20% к этому объему. Итого: 183 ТБ * 1.2 ≈ 220 ТБ/день
- Средняя полоса пропускания: 220 ТБ / (16 * 3600) ≈ 3.82 Гбит/с
- Пиковая полоса пропускания: 3.82 Гбит/с * 7 ≈ 26.7 Гбит/с

**Суммарный трафик:**
- Суммарный суточный объем: 2 790 ТБ + 220 ТБ (Аудио) ≈ 3 010 ТБ/сутки или ~2.94 ПБ/сутки
- Суммарная пиковая полоса пропускания: 339 Гбит/с + 26.7 Гбит/с (Аудио) ≈ 366 Гбит/с

| Действие пользователя | Средний RPS | Пиковый RPS | Пиковое потребление (Гбит/с) | Суммарный суточный объем (ГБ/сутки) |
| :--- | :--- | :--- | :--- | :--- |
| **Все API-запросы** | ~10 850 | ~76 000 | ~339 | ~2 790 000 |
| **Аудио-трафик** | - | - | ~26.7 | ~220 000 |
| **Итого (Всего)** | ~10 850 | ~76 000 | ~366 | ~3 010 000 |

**Ключевые допущения:**

1.  Пиковая нагрузка: активность пользователей распределена неравномерно. Пик нагрузки обычно в вечернее время. Возьмем коэффициент пиковой нагрузки x7 от средней нагрузки.
2.  Профиль пользователя: пользователь проводит в приложении 15.65 минут (~940 секунд) в день и генерирует 4 минуты аудио.
3.  Состав урока: урок — это не один запрос, а сессия из множества действий. Оценим, что в среднем за свою сессию пользователь совершает ~50 различных запросов (получить задание, отправить ответ, получить следующее, отправить аудио, обновить прогресс и т.д.).

## Список использованных источников
1. https://ru.wikipedia.org/wiki/Duolingo
2. https://investors.duolingo.com/static-files/d667f9d1-8f7f-418c-b116-e699a30a9826
4. https://usesignhouse.com/blog/duolingo-stats/
5. https://cooljugator.com/blog/duolingo-statistics/
6. https://hu.duolingo.com/privacy
7. https://digitark.telia.ee/ru/era/%D0%B2%D1%81%D0%B5-%D1%82%D0%BE%D1%87%D0%BA%D0%B8-%D0%BD%D0%B0%D0%B4-%D0%B8%D1%82-%D0%BA%D0%B0%D0%BA-%D0%B2%D1%8B%D0%B1%D1%80%D0%B0%D1%82%D1%8C-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BC-%D0%BC%D0%BE/#:~:text=%D0%9D%D0%B8%D0%B7%D0%BA%D0%BE%D0%B5%20%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE%20%D0%B0%D1%83%D0%B4%D0%B8%D0%BE%20(96kpps)%20%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D1%82,115%2C2%20%D0%9C%D0%B1%20%D0%B2%20%D1%87%D0%B0%D1%81.
8. https://www.statista.com/statistics/1309604/duolingo-quarterly-dau/
9. https://duolingoguides.com/how-many-people-use-duolingo/
